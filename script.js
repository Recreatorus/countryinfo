const countryList=document.getElementById("countryList");var currentDate=new Date;function offsetToMs(t){const[e,n]=t.replace(/utc/i,"").split(":").map((t=>Number(t.replace(/\D/,"")))),a=60*e*60*1e3+60*n*1e3;return t.includes("-")?-a:a}!function(){function t(t,e,n){return void 0===n||0==+n?Math[t](e):(e=+e,n=+n,isNaN(e)||"number"!=typeof n||n%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-n:-n)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+n:n))))}Math.round10||(Math.round10=function(e,n){return t("round",e,n)}),Math.floor10||(Math.floor10=function(e,n){return t("floor",e,n)}),Math.ceil10||(Math.ceil10=function(e,n){return t("ceil",e,n)})}();const searchcountry=async t=>{const e=await fetch("./data/countries.json");let n=(await e.json()).filter((e=>{const n=new RegExp(`^${t}`,"gi");return e.country.match(n)||e.abbr.match(n)}));0===t.length&&(n=[],countryList.innerHTML=""),outputHtml(n);let a=document.querySelectorAll(".capitalCity");a.forEach((t=>{t.addEventListener("click",(function(){a.forEach((t=>t.classList.remove("active"))),this.classList.add("active");var t=this.querySelector("span").textContent||this.querySelector("span").innerText;fetch(`https://api.openweathermap.org/data/2.5/weather?q=${t}&appid=4d8fb5b93d4af21d66a2948710284366&units=metric`).then((t=>t.json())).then((t=>{const{main:e,name:n,sys:a,weather:r}=t,c=`./img/weather/${r[0].icon}.svg`,i=document.querySelector(".capitalCity.active #capitalWeather"),s=`\n            <div class="city-name" data-name="${n},${a.country}">\n              <span>${n}</span>\n            </div>\n            <div class="city-temp">${Math.round(e.temp)}<sup>°C</sup></div>\n            <figure>\n              <img class="city-icon" src="${c}" alt="${r[0].description}">\n              <figcaption>${r[0].description}</figcaption>\n            </figure>\n          `;i.innerHTML=s})).catch((()=>{a.textContent="Please search for a valid city"}))}))}));let r=document.querySelectorAll(".currency");r.forEach((t=>{t.addEventListener("click",(function(){r.forEach((t=>t.classList.remove("currency-open"))),this.classList.add("currency-open");var t=this.querySelector("span").textContent||this.querySelector("span").innerText;fetch("https://openexchangerates.org/api/latest.json?app_id=507f9314f79f467d9605061678f7e286").then((t=>t.json())).then((e=>{const n=document.querySelector(".currency-open #currencyData");const a=`\n            <span>1 US$ = ${new Intl.NumberFormat("en-EN",{style:"currency",currency:`${t}`,currencyDisplay:"name"}).format(`${e.rates[t]}`)}</span>\n          `;n.innerHTML=a})).catch((()=>{r.textContent="There is no data",console.log("There is no data")}))}))}))},outputHtml=t=>{if(t.length>0){const e=t.map((t=>`\n          <div class="card">\n            <div class="card-top">\n              <div class="card-title">${t.country}</div>\n              <img src="./img/flags/${t.code.toLowerCase()}.svg">\n            </div>\n            <div class="card-data">\n              <div class="population">\n              Population: <span>${new Intl.NumberFormat("ru-RU").format(t.population)}</span></div>\n              <div class="density">Density: <span>${new Intl.NumberFormat("ru-RU").format(Math.round10(t.density,-1))} /km<sup>2</sup></span></div>\n              <div class="area">Area: <span>${(t.area/1e3).toFixed(1).replace(/\B(?=(\d{3})+(?!\d))/g," ")}K km<sup>2</sup></span></div>\n              <div class="area">GDP: <span>$${new Intl.NumberFormat("ru-RU").format(Math.round10(t.gdp2022,0))} bln.</span></div>\n              <div class="area">GDP PC: <span>$${new Intl.NumberFormat("ru-RU").format(Math.round10(t.gdppc2022,0))}</span></div>\n              <div class="capitalCity">Capital: <span class="capitalName">${t.capital}</span>\n                <div id="capitalWeather"></div>\n              </div>\n              <div class="countryCode">Country Code: <span>${t.phoneCode}</span></div>\n              <div class="currency">Сurrency: <span>${t.currency}</span>\n                <div id="currencyData"></div>\n              </div>\n              <div class="time">Time in the capital: <span>${new Date((new Date).getTime()+offsetToMs(`${t.timezones}`)).toUTCString()}</span></div>\n            </div>\n          </div>\n        `)).join("");document.getElementById("countryList").innerHTML=e}};document.getElementById("search").addEventListener("input",(()=>searchcountry(search.value))),document.addEventListener("DOMContentLoaded",(()=>{document.getElementById("search").focus({focusVisible:!0})}));
